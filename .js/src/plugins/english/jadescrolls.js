var e=this&&this.__awaiter||function(e,a,t,l){return new(t||(t=Promise))((function(n,r){function o(e){try{i(l.next(e))}catch(e){r(e)}}function c(e){try{i(l.throw(e))}catch(e){r(e)}}function i(e){var a;e.done?n(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(o,c)}i((l=l.apply(e,a||[])).next())}))},a=this&&this.__generator||function(e,a){var t,l,n,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(i){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(r=0)),r;)try{if(t=1,l&&(n=2&c[0]?l.return:c[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,c[1])).done)return n;switch(l=0,n&&(c=[2&c[0],n.value]),c[0]){case 0:case 1:n=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,l=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==c[0]&&2!==c[0])){r=0;continue}if(3===c[0]&&(!n||c[1]>n[0]&&c[1]<n[3])){r.label=c[1];break}if(6===c[0]&&r.label<n[1]){r.label=n[1],n=c;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(c);break}n[2]&&r.ops.pop(),r.trys.pop();continue}c=a.call(e,r)}catch(e){c=[6,e],l=0}finally{t=n=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}},t=this&&this.__spreadArray||function(e,a,t){if(t||2===arguments.length)for(var l,n=0,r=a.length;n<r;n++)!l&&n in a||(l||(l=Array.prototype.slice.call(a,0,n)),l[n]=a[n]);return e.concat(l||Array.prototype.slice.call(a))};Object.defineProperty(exports,"__esModule",{value:!0});var l=require("@libs/fetch"),n=require("@libs/filterInputs"),r=require("@libs/novelStatus"),o="https://api.jadescrolls.com/api";function c(t){return e(this,void 0,void 0,(function(){var e,n,r;return a(this,(function(a){switch(a.label){case 0:return[4,(0,l.fetchApi)(t,{headers:{"Cache-Control":"no-store","If-None-Match":""}})];case 1:return(e=a.sent()).status>=300&&e.status<400&&(n=e.headers.get("location"))?[2,c(n)]:304===e.status||"0"===e.headers.get("content-length")?[2,{}]:[4,e.text()];case 2:return(r=a.sent())?[2,JSON.parse(r)]:[2,{}]}}))}))}var i={},s={COMPLETED:r.NovelStatus.Completed,ONGOING:r.NovelStatus.Ongoing,HIATUS:r.NovelStatus.OnHiatus,DROPPED:r.NovelStatus.Cancelled},u=function(){function l(){var e=this;this.id="jadescrolls",this.name="JadeScrolls",this.icon="src/en/jadescrolls/icon.png",this.site="https://jadescrolls.com",this.version="1.0.0",this.resolveUrl=function(a,t){return t?"".concat(e.site,"/novel/").concat(a):e.site},this.filters={sort:{type:n.FilterTypes.Picker,label:"Sort By",value:"weekly_views",options:[{label:"Popular (Weekly)",value:"weekly_views"},{label:"Rating",value:"rating"},{label:"Newest",value:"created_at"}]},genre:{type:n.FilterTypes.Picker,label:"Genre",value:"",options:[{label:"All",value:""},{label:"Action",value:"34e5c717-8648-4cc1-b796-b6d02d49d170"},{label:"Adult",value:"3eb04793-6bd8-4af7-8cde-34ae8e953cbd"},{label:"Adventure",value:"f815320a-34a8-45d7-a461-ef238857c2ed"},{label:"Comedy",value:"c3c870a5-825c-4f94-b5f6-f51a367fee02"},{label:"Cultivation",value:"a3d4e884-0651-44bf-a7e6-f456328e8c52"},{label:"Drama",value:"c4809ae2-f681-4ca8-8201-72278fd7df05"},{label:"Ecchi",value:"f65cc3cb-d5e2-45ec-8edf-6b6866a1af71"},{label:"Fantasy",value:"c8b536fa-9436-4b93-90fb-8a7bb2be8550"},{label:"Game",value:"09acd8fa-028c-4bdd-8e76-b45d3a57badc"},{label:"Harem",value:"b22cbc2f-1815-47c0-9fbc-95e7e648b9be"},{label:"Heart-warming",value:"cca23f76-ec48-4432-9e4a-444cac40f2f3"},{label:"Historical",value:"afc657a7-2706-4641-9299-4d3a7d738537"},{label:"Horror",value:"260b735b-70d8-49a5-81b8-a1e5c0a95d0b"},{label:"Isekai",value:"955e790b-c378-4df4-9a91-5dd2d21a9f53"},{label:"LGBTQ+",value:"7b8244e2-a9f4-4a60-ac46-888b46efad20"},{label:"Martial Arts",value:"82892983-1c94-4a1e-a033-09b81f008ef1"},{label:"Modern",value:"bd91ba05-0c66-489c-b322-23d679dd5e4d"},{label:"Mystery",value:"4bb0a253-558c-4e32-851d-2c2eabc2ce2e"},{label:"Reincarnation",value:"8d63a221-0f55-4306-b5a1-344bf5f1a8a0"},{label:"Romance",value:"8071a9d5-9e46-42ed-aa3a-bdaabe2b62a7"},{label:"School Life",value:"6d769f67-d6e2-4287-a4b4-e8f4f40e91d2"},{label:"Sci-Fi",value:"7551dfdd-5fea-4a46-a4dd-e4cfd666a40e"},{label:"Seinen",value:"9a0698fe-00f9-4463-becc-bb44d0ed8508"},{label:"Shounen",value:"93996ab2-684d-4b78-afda-3b35ef04afce"},{label:"Slice of Life",value:"f459e8b2-4976-427b-a576-7736ed6eaed9"},{label:"Smut",value:"43e6547a-2784-4fdc-b208-099f8c7331ba"},{label:"Supernatural",value:"5c6c028c-0623-4b6d-8e28-b2c4321e1311"},{label:"Survival",value:"60410f83-6201-452d-9568-bf1fb9350961"},{label:"System",value:"3f50190b-b296-4364-b7a9-9678d1ed2420"},{label:"Thriller",value:"7f9ea4f3-df3d-44a5-8cbb-062b2d635029"},{label:"Transmigration",value:"1e2bcdc8-b21b-4bd4-bdb9-db82642c4b89"},{label:"Xianxia",value:"05123b95-5d18-4d67-8cb6-f04b9a25695b"}]},novelLead:{type:n.FilterTypes.Picker,label:"Novel Lead",value:"",options:[{label:"All",value:""},{label:"Male",value:"MALE"},{label:"Female",value:"FEMALE"}]},type:{type:n.FilterTypes.Picker,label:"Novel Type",value:"",options:[{label:"All",value:""},{label:"Original",value:"ORIGINAL"},{label:"Translated",value:"TRANSLATED"}]}}}return l.prototype.popularNovels=function(t,l){return e(this,arguments,void 0,(function(e,t){var l,n,r,i,s,u=t.filters;return a(this,(function(a){switch(a.label){case 0:return l=new URLSearchParams({page:String(e),limit:"20",sortBy:(null===(n=null==u?void 0:u.sort)||void 0===n?void 0:n.value)||"weekly_views",sortOrder:"desc"}),(null===(r=null==u?void 0:u.genre)||void 0===r?void 0:r.value)&&l.set("genre",u.genre.value),(null===(i=null==u?void 0:u.novelLead)||void 0===i?void 0:i.value)&&l.set("novelLead",u.novelLead.value),(null===(s=null==u?void 0:u.type)||void 0===s?void 0:s.value)&&l.set("type",u.type.value),[4,c("".concat(o,"/novels/list?").concat(l.toString()))];case 1:return[2,a.sent().data.map((function(e){return{name:e.title,path:e.slug,cover:e.cover_image}}))]}}))}))},l.prototype.parseNovel=function(l){return e(this,void 0,void 0,(function(){var e,n,u,b,d,v,f;return a(this,(function(a){switch(a.label){case 0:return[4,c("".concat(o,"/novels?slug=").concat(l))];case 1:return e=a.sent(),i[l]=e.id,n=t(t([],e.genres.map((function(e){return e.name})),!0),e.sub_genres.map((function(e){return e.name})),!0),u={path:l,name:e.title,cover:e.cover_image,summary:null===(d=e.synopsis)||void 0===d?void 0:d.replace(/<[^>]+>/g,""),author:e.author_name,artist:e.translator_name||void 0,genres:n.join(","),status:s[null===(v=e.metadata)||void 0===v?void 0:v.release_status]||r.NovelStatus.Unknown,rating:(null===(f=e.metadata)||void 0===f?void 0:f.average_rating)?e.metadata.average_rating:void 0,totalPages:0,chapters:[]},[4,c("".concat(o,"/novels-chapter/").concat(e.id,"/chapters/list?page=1&limit=").concat(100,"&sortOrder=asc&status=PUBLISHED"))];case 2:return b=a.sent(),u.totalPages=b.meta.total_pages,u.chapters=this.mapChapters(b.data,e.id),[2,u]}}))}))},l.prototype.parsePage=function(t,l){return e(this,void 0,void 0,(function(){var e,n,r;return a(this,(function(a){switch(a.label){case 0:return(e=i[t])?[3,2]:[4,c("".concat(o,"/novels?slug=").concat(t))];case 1:n=a.sent(),e=n.id,i[t]=e,a.label=2;case 2:return[4,c("".concat(o,"/novels-chapter/").concat(e,"/chapters/list?page=").concat(l,"&limit=").concat(100,"&sortOrder=asc&status=PUBLISHED"))];case 3:return r=a.sent(),[2,{chapters:this.mapChapters(r.data,e)}]}}))}))},l.prototype.mapChapters=function(e,a){return e.filter((function(e){return"FREE"===e.type})).map((function(e){return{name:e.title,path:"".concat(a,"/").concat(e.id),releaseTime:e.publish_at,chapterNumber:e.chapter_number}}))},l.prototype.parseChapter=function(t){return e(this,void 0,void 0,(function(){var e,l,n,r,i;return a(this,(function(a){switch(a.label){case 0:return e=t.split("/"),l=e[0],n=e[1],[4,c("".concat(o,"/novels-chapter/").concat(l,"/chapters/").concat(n))];case 1:return r=a.sent(),i=r.content||"",r.author_note&&(i+="<hr/><b>Author's Note:</b><br/>".concat(r.author_note)),[2,i]}}))}))},l.prototype.searchNovels=function(t,l){return e(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return l>1?[2,[]]:[4,c("".concat(o,"/public/search?query=").concat(encodeURIComponent(t)))];case 1:return[2,(e.sent().novels||[]).map((function(e){return{name:e.title,path:e.slug,cover:e.cover_image}}))]}}))}))},l}();exports.default=new u;